DNS란 무엇인가 <Badge text="song" />
=========================

> 생활코딩 [Domain Name System](https://opentutorials.org/course/3276) 수업을 듣고 정리한 자료입니다.

DNS
------

<code>DNS</code> 란 Domain Name System의 줄임말이다. DNS는 숫자로 된 식별 번호(IP 주소)를 사람들이 식별하기 쉬운 이름으로 변환하거나 반대로 이름으로 된 주소를 숫자로 된 IP주소로 해석해주는 역할을 한다.

참고로 여기서 이름이란 도메인 네임(Domain Name)을 말한다.

역사
----

DNS가 도입되기 이전엔 hosts.txt가 있었다. hosts파일은 일종의 변환표로, hosts파일엔 자신의 컴퓨터 호스트 네임(Host Name)과 IP주소가 저장되어있어 파일의 내용을 수정하면 IP주소를 원하는 이름으로 변환할 수 있었다.

> 윈도우의 경우 C:\Windows\System32\drivers\etc\hosts 에 위치해있다.

### DNS 탄생

당시엔 개별 호스트가 NIC(ARPAnet NIC)가 관리하는 FTP 서버로 접속하여 호스트 정보가 담긴 hosts파일을 다운받아 사용하는 방식을 사용했는데 이는 인터넷의 발달로 사용자 수가 급증하면서 한계에 부딪히게 된다.<br>

-	트래픽 과부하: 호스트 수가 증가함에 따라 hosts파일의 크기가 커지고 접속자 역시 늘면서 병목현상 발생  
-	이름 충돌: 각각의 다른 개별 호스트에서 호스트 네임을 동일하게 설정했을 경우 이름 충돌이 발생함  
-	일관성: 개별 호스트의 정보가 바뀌어도 모든 사용자에게 신속하게 변경된 정보를 전달할 수 없음  
	<br> 이후 1983년,  
	위 문제점들을 해결하기 위해 DNS가 개발되면서 DNS 도입의 서막을 열게된다.

DNS 구조
--------

DNS는 거대한 분산구조의 네임체계이며 도메인 네임 스페이스, 네임 서버, 리졸버로 구성되어있다.

### 도메인 네임 스페이스(Domain Name Space)

<code>도메인 네임 스페이스</code> 는 DNS가 저장/관리하는 계층적 데이터베이스이다. DNS의 최상위엔 루트(Root)가 존재하고, 그 하위로는 레이블(label)이 부여된 *노드(Node)들이 역트리 구조로 이어져 있다.  
> 트리 구조에서 각 가지로 분기되는 지점을 노드라 하고 각 노드의 이름을 레이블이라한다.   


도메인 네임 스페이스에서 루트는 특별한 정보를 담고있지않다.  
다른말로 루트의 레이블은 NULL OR EMPTY기 때문에 이름이 없고 그 자체로는 생략된다해도 문제가 발생하지않는다.  
ex) blog.example.com(.)   


루트의 하위는 여러 레벨로 나뉘는데 최상위 레벨 도메인(Top Level Domain) , 제 2 레벨 도메인(Second Level Domain), 제 3 레벨 도메인 또는 서브 도메인(Third Level/Sub Domain)으로 구성되어있다. 이 노드들은 크기가 최대 63바이트인 레이블을 가지며 같은 레벨 안에서 유일한 이름을 갖는다.

<br>
<img src="https://t1.daumcdn.net/cfile/tistory/25477D4E5916B32812" alt="DNS 트리 구조" height="400px" />  
<br>
<br>

DNS는 계층적 데이터베이스이다.  
즉, 도메인 네임들은 하나의 서버에 저장되어지는게 아니라 각각의 독자적인 서버로 분산되어 계층적 구조로 저장된다. 최상위부터 순차적으로 계층적 소속 관계를 나타내며 각 레벨의 도메인 관리자는 해당 도메인의 하위 영역을 관리할 수 있는 권한을 지니며 하위 영역의 레이블에 포함된 정보를 알고있어야한다.

하지만, 이는 무조건 자신의 바로 아래인 하위 영역만을 의미한다. 예로 루트가 세컨드 도메인을, 탑 도메인이 서브도메인을 아는 것은 불가능하다. DNS 서버는 도메인 영역을 위임받은 관리 주체가 해당 도메인을 관리하는 위임체계를 가지고 있기 때문에 다른 도메인에 속한 호스트 정보를 알기위해서는 해당 도메인을 관리하는 네임서버를 통해야한다.

> 임의의 네임서버가 관리하는 영역을 존(Zone)이라 한다.

### 네임서버(Name Server)

<code>네임서버</code> 는 도메인 네임들의 정보(도메인 네임에 관한 리소스 레코드 데이터)를 저장하고 있는 서버이다. 각 네임서버는 존으로 구분된 영역에 속한 리소스 데이터를 가지며 네임서버의 존파일(Zone file)은 해당 네임서버가 관리하는 도메인 존과 리소스 레코드 데이터 내용을 정의한다.

네임서버는 서버-클라이언트 모델에 의해 동작하며 리졸버로부터 요청 받은 IP정보를 다실 리졸버로 전달해주는 역할을 수행한다. 여기서 리졸버는 DNS 서버에 질의를 보내는 클라이언트에 해당한다.

### 리졸버(Resolver)

<code>리졸버(해석기)</code> 는 DNS 클라이언트의 질의 요청을 네임 서버에게 전달하고 네임 서버로부터 정보를 담은 DNS 회신 메시지를 받아 클라이언트에게 제공하는 기능을 수행한다. 여기서 리졸버는 스스로 리소스 레코드 데이터에 대한 질의동작을 하는 것이 아니라, 응용 어플리케이션을 대신하여 DNS 질의를 수행하고 파악된 데이터를 응용 어플리케이션에 리턴한다. > ISP와 회사 및 기관에서 사용하는 캐시 네임서버(Cache Name Server)는 리졸버이다.

리졸버는 대상 도메인 네임이 어느 네임서버에 존재하는 지 파악하기 위해, 루트 도메인의 네임서버로부터 조회를 시작한다. 루트 네임서버는 도메인 네임이 속한 위임된 하위 도메인에 대한 네임서버 정보를 리졸버에게 넘겨주고(루트 네임서버의 존에 설정된 자식 도메인에 관한 정보) 리졸버는 계층구조대로 최종 네임서버까지 파악하여 최종 네임서버에게 정보를 받는다.

리졸버가 보내는 질의는 두가지 종류로 아래와 같다.

#### 재귀적 질의(Recursive Queries)

-	일반적인 네임 서버 유형
-	클라이언트에 최종 결과값을 반환함
-	클라이언트로부터 도메인 네임 질의 요청이 들어올 경우 직접 네임 서버를 탐색하여 결과값을 반환
-	찾고있는 정보가 없을 경우 에러 메시지를 보냄

#### 반복적 질의(Iterative Queries)

-	자신이 직접 관리하지 않는 질의 요청이 있을 경우 응답 가능한 네임서버 목록 전달
-	루트는 무조건 반복적 질의

<br>
<img src= https://t1.daumcdn.net/cfile/tistory/2464753E5916B3F22A alt="DNS 트리 구조" height="350px" />  
<br>

### 리소스 레코드(Resource record)

<code>리소스 레코드</code>는 유일성을 갖는 도메인 이름에 설정할 수 있는 다양한 데이터 유형을 제공한다. 여기서 다양한 데이터란 IP주소 데이터만이 아니라 문자열 데이터, 제공하는 서비스 포트 번호, 지리정보 등과 같은 데이터들을 말한다. 리소스 레코드는 확장성이 좋아 계속해서 데이터들이 추가 정의되고 있는데 현재까지 정의된 모든 리소스 레코드 유형은[IANA](https://www.iana.org/)에서 볼 수 있다.

DNS 기본 동작
-------------

사용자가 요청한 도메인의 IP 주소는 Local DNS 서버가 다른 DNS 서버와 통신하여 사용자에게 제공한다.
즉, Local DNS 서버는 사용자의 요청을 대신하여 해당 도메인의 IP 주소 정보를 획득할 때까지 필요에 따라 여러 DNS 서버와의 통신을 수행하고(Recursion, 재귀적 통신), 해당 정보를 획득한 후 사용자에게 그 결과 값을 전달한다. (Local DNS 서버에 캐쉬되어 있는 경우에는 다른 DNS 서버와의 연동 없이 바로 사용자에게 결과 값을 전달한다.) 

<br>

------------------

-	이미지 출처 [데이터 통신과 컴퓨터 네트워크](https://terms.naver.com/imageDetail.nhn?docId=2271996&imageUrl=https%3A%2F%2Fdbscthumb-phinf.pstatic.net%2F3578_000_1%2F20141023224649357_CGWCGY0RK.jpg%2Fka8_209_i1.jpg%3Ftype%3Dm4500_4500_fst_n%26wm%3DY)
-	참고 [인터넷 이용의 기반 DNS의 이해와 DNS 보안](https://www.kisa.or.kr/uploadfile/201310/201310071959231513.pdf)
-	참고 [DNS 기본 동작 원리](https://www.netmanias.com/ko/post/techdocs/5259/dns-network-protocol/dns-basic-operation)
